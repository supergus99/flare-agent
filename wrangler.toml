# Flare – Cloudflare Worker
# Set account_id after: npx wrangler whoami (or from Cloudflare Dashboard)
name = "flare-worker"
main = "src/index.js"
compatibility_date = "2024-01-01"

# Uncomment and set your Account ID (from Workers & Pages in Dashboard):
# account_id = "YOUR_ACCOUNT_ID"

# D1
[[d1_databases]]
binding = "DB"
database_name = "flare-db"
database_id = "4cdf2868-c471-4005-9231-226c3289549f"

# R2 – create bucket "flare-reports" in Dashboard (Workers R2 Storage) first
[[r2_buckets]]
binding = "REPORTS"
bucket_name = "flare-reports"

# Queues – create queue "flare-jobs" in Dashboard (Workers & Pages > Queues) first
[[queues.producers]]
queue = "flare-jobs"
binding = "JOBS"

[[queues.consumers]]
queue = "flare-jobs"
max_batch_size = 1
max_batch_timeout = 30

# MCP enrichment: when set, assessment submissions trigger MCP (domain scan, NVD, report → email)
[vars]
MCP_SERVICE_URL = "https://mcp-service.gusmao-ricardo.workers.dev"

# Optional: set at deploy time for admin version block (GET /api/version)
# e.g. in CI: GIT_VERSION=$(git rev-parse --short HEAD) and LAST_UPDATED with build date
# GIT_VERSION = "abc1234"
# LAST_UPDATED = "14 Feb 2025, 15:30"
